<!DOCTYPE html>
<html lang="en">
<head>
	<title>JS FE</title> 
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<style>
		*{
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		.game{
			margin: 100px auto;
			width: 400px;
			height: 400px;
			display: flex;
			flex-flow: row wrap;
		}

		.square {
			width: 100px;
			height: 100px;
			border: 1px solid black;
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 50px;
		}

	</style>
</head>
<body>


	<div class="game"></div>

	
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
  crossorigin="anonymous"></script>
	
	<script >
		
		// 2048

		let squares = new Array(16);
		squares.fill('');

		function drawGame(){
			createNum();
			$('.game').html('');
			squares.forEach((item, index) => {
				$('.game').append(`<div class="square" data-id="${index}">${item}</div>`);
			});
		}
		
		drawGame();

	

		function createNum(){
			const num = Math.random() > 0.85 ? 4 : 2;
			const freeCells = [];
			squares.forEach((item, index) => item === '' ? freeCells.push(index) : null);
			const cell = Math.floor(Math.random()*freeCells.length-1);
			const pos = freeCells[cell];
			
			squares[pos] = num;
			$(`.square:nth-of-type(${cell+1})`).text(num);
			
			if(freeCells.length <= 1){
				checkGameOver();
			}
		}

		function moveLeft(){
			const rows = createRows();
			const input = rows.toString();

			for(let i = 0; i < rows.length; i++){
				for(let j = 1;  j < rows[i].length; j++){
					for(let k = j; k > 0; k--){
						if(rows[i][k-1] === ''){
							rows[i][k-1] = rows[i][k];
							rows[i][k] = '';
						}
						if(rows[i][k] === rows[i][k-1] && rows[i][k] != ''){
							rows[i][k-1] = rows[i][k-1]*2;
							rows[i][k] = '';
							// add score
						}
					}
				}
			}

			const ouput = rows.toString();
			if(input === ouput){
				console.error('Nothing was moved');
			}
			else{
				squares = rows.flat(2);
				drawGame();
			}
		}

		function moveRight(){
			const rows = createRows();
			const input = rows.toString();

			for(let i = 0; i < rows.length; i++){
				for(let j = rows[i].length -1; j > 0; j--){
					for(let k = 0; k < rows[i].length; k++){
						if(rows[i][k+1] === ''){
							rows[i][k+1] = rows[i][k];
							rows[i][k] = '';
						}
						if(rows[i][k] === rows[i][k+1] && rows[i][k] != ''){
							rows[i][k+1] = rows[i][k+1]*2;
							rows[i][k] = '';
							// add score
						}
					}
				}
			}

			const ouput = rows.toString();
			if(input === ouput){
				console.error('Nothing was moved');
			}
			else{
				squares = rows.flat(2);
				drawGame();
			}
		}

		function moveUp(){
			const cols = createCols();
			const input = cols.toString();

			for(let i = 0; i < cols.length; i++){
				for(let j = 1;  j < cols[i].length; j++){
					for(let k = j; k > 0; k--){
						if(cols[i][k-1] === ''){
							cols[i][k-1] = cols[i][k];
							cols[i][k] = '';
						}
						if(cols[i][k] === cols[i][k-1] && cols[i][k] != ''){
							cols[i][k-1] = cols[i][k-1]*2;
							cols[i][k] = '';
							// add score
						}
					}
				}
			}

			const ouput = cols.toString();
			if(input === ouput){
				console.error('Nothing was moved');
			}
			else{
				squares = flatenCols(cols);
				drawGame();
			}
		}


		function moveDown(){
			const cols = createCols();
			const input = cols.toString();

			for(let i = 0; i < cols.length; i++){
				for(let j = cols[i].length -1; j > 0; j--){
					for(let k = 0; k < cols[i].length; k++){
						if(cols[i][k+1] === ''){
							cols[i][k+1] = cols[i][k];
							cols[i][k] = '';
						}
						if(cols[i][k] === cols[i][k+1] && cols[i][k] != ''){
							cols[i][k+1] = cols[i][k+1]*2;
							cols[i][k] = '';
							// add score
						}
					}
				}
			}

			const ouput = cols.toString();
			if(input === ouput){
				console.error('Nothing was moved');
			}
			else{
				squares = flatenCols(cols);
				drawGame();
			}
		}

		function checkGameOver(){
			const canMove = checkCanMove();
			if(!canMove.canMoveLeftRight && !canMove.canMoveUpDown){
				finishGame();
			}
		}

		function finishGame(){
			alert('Game Over');
		}

		function checkCanMove(num){
			const cols = createCols();
			const rows = createRows();

			let canMoveLeftRight = false;
			let canMoveUpDown = false;

			for(let i = 0; i < cols.length; i++){
				for(let j = 1; j < cols[i].length; j++){
					if(cols[i][j] === cols[i][j-1] || (cols[i][j] === '' || cols[i][j-1] === '')){
						canMoveUpDown = true;
					}
				}
			}

			for(let i = 0; i < rows.length; i++){
				for(let j = 1; j < rows[i].length; j++){
					if(rows[i][j] === rows[i][j-1] || (rows[i][j] === '' || rows[i][j-1] === '')){
						canMoveLeftRight = true;
					}
				}
			}

			return {
				canMoveLeftRight: canMoveLeftRight,
				canMoveUpDown: canMoveUpDown
			}
		}

		function createRows(){
			const newSquares = [];
			let row = [];
			for(let i = 0; i < squares.length; i++){
				row.push(squares[i]);
				if((i+1)%4 === 0){
					newSquares.push(row);
					row = [];
				}
			}
			return newSquares;
		}

		function createCols(){
			const newSquares = [];
			for(let i = 0; i < 4; i++){
				const col = [];
				for(let j = 0; j < 4; j++){
					col.push(squares[(4*j) + i]);
				}
				newSquares.push(col);
			}
			return newSquares;
		}

		function flatenCols(arr){
			const flat = [];
			for(let i = 0; i < arr.length; i++){ //0 1 2 3 4
				for(let j = 0; j < arr[i].length; j++){ // 0 4 8 12   1 5 9 13  2 6 10 14
					flat.push(arr[j][i]);
				}
			}
			return flat;
		}



		$(document).on('keyup', (e)=>{
			if(e.key === 'ArrowLeft'){
				moveLeft();
			}
			if(e.key === 'ArrowRight'){
				moveRight();
			}
			if(e.key === 'ArrowUp'){
				moveUp();
			}
			if(e.key === 'ArrowDown'){
				moveDown();
			}
		});

		
	</script>


</body>
</html>