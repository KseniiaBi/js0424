<!DOCTYPE html>
<html lang="en">
<head>
	<title>JS FE</title> 
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<style>
		*{
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		header {
			display: flex;
			justify-content: space-between;
		}

		.shop {
			display: flex;
			flex-flow: row wrap;
			align-items: flex-start;
			justify-content: space-evenly;
			margin: 100px 0;
		}

		.product{
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			width: 23%;
			border-radius: 3px;
			border: 1px solid #e2e2e2;
			margin-bottom: 40px;
		}

		.product img{
			width: 100%;
			height: 150px;
			object-fit: cover;
			object-position: center;
		}

		.selectbox {
			position: relative;
			width: 200px;
			height: 32px;
			font-size: 20px;
			padding: 0 10px;
			margin: 40px 0;
			border: 1px solid #e2e2e2;
			cursor: pointer;
		}

		.selectbox::after{
			position: absolute;
			z-index: 3;
			content: 'ðŸ”½';
			right: 10px;
			top: 2px;
			transition: transform 0.3s linear;
		}

		.select_options{
			display: none;
			position: absolute;
			top: 100%;
			left: 0;
			width: 100%;
			border: 1px solid #e2e2e2;
		}

		.option {
			padding: 10px;
		}

		.option + .option {
			border-top: 1px solid #e2e2e2;
		}

		.selectbox.expanded .select_options{
			display: block;
		}
		.selectbox.expanded:after{
			transform: rotate(180deg);
		}

	</style>
</head>
<body>

	<header>
		<div class="logo">LOGO</div>
		<nav>
			<a href="#">Shop</a>
			<a href="#">About</a>
			<a href="#">Contact</a>
			<a href="cart.html">
				<span class="cart_count">0</span> item(s), 
				<span class="cart_total">0</span> UAH  in ðŸ›’  </a>
		</nav>
	</header>

	<select class="sorter">
		<option disabled selected>Sort by</option>
		<option value="name">Sort by name</option>
		<option value="price">Sort by price</option>
	</select>

	<div class="selectbox">
		<div class="selected">Sort by</div>
		<div class="select_options">
			<div class="option" data-value="name">Sort by name</div>
			<div class="option" data-value="price">Sort by price</div>
		</div>
	</div>

	<div class="shop"></div>
	
	
	<script>

		// http request

		// 1) XMLHttpRequest

		// url method [GET, POST, PUT, DELETE] sync [yes/no]
		let data;
		const shop = document.querySelector('.shop');
		const URL = 'data.json'; // https://openweatherapi.com/mnsflsflksfe.....sddfm

		const xhr = new XMLHttpRequest(); // readyState = 0
		// xhr.onreadystatechange = () => {
		// 	if(xhr.readyState === 3){
		// 		console.log("In progress");
		// 	}
		// 	else if(xhr.readyState === 4){
		// 		console.log('Ready!');
		// 	}
		// };
		xhr.open('GET', URL); // xhr.open('GET', url, async*, user*, pass*); // readyState = 1
		xhr.send();  // readyState = 2
		// readyState = 3 can be used for loaders

		xhr.onload = () => {
			data = JSON.parse(xhr.responseText);
			showProducts();
		}

		function showProducts(){
			data.forEach(item => createProductMarkup(item));
		}
		
		function createProductMarkup(obj){
			const product = document.createElement('div');
			product.classList.add('product');

			const img = new Image();
			img.src = obj.image;
			img.alt = obj.name;

			const prodName = document.createElement('h4');
			prodName.innerText = obj.name;
			prodName.classList.add('prod_name');

			const price = document.createElement('h2');
			price.textContent = `${obj.price} UAH`;
			price.classList.add('prod_price');

			const btnBuy = document.createElement('button');
			btnBuy.innerText = 'Add to cart';
			btnBuy.onclick = () => addToCart(obj.id);

			product.append(img, prodName, price, btnBuy);

			shop.append(product);
		}


		// sort products

		const selectbox = document.querySelector('.sorter');
		selectbox.onchange = () => sortProducts(selectbox.value);

		// with dropdown

		const selbox = document.querySelector('.selectbox');
		const selected = document.querySelector('.selected');
		selbox.onclick = (e) => {
			selbox.classList.toggle('expanded');
			if(e.target.classList.contains('option')){
				selected.innerText = e.target.innerText;
				sortProducts(e.target.dataset.value);
			}
		};

		function sortProducts(attr){
			let prods = document.querySelectorAll(`.prod_${attr}`);
			prods = [].slice.call(prods);

			prods.sort((a,b) => {
				if(attr === 'name'){
					a = a.innerText;
					b = b.innerText;
				}
				else{
					a = +a.innerText.slice(0, a.innerText.length - 4);
					b = +b.innerText.slice(0, b.innerText.length - 4);
				}

				return a === b ? 0 : a<b ? -1 : 1;
			});

			prods.forEach((item, index) => item.parentNode.style.order = index);
		}


		// cart 

		const cart = [];
		let cartTotal = 0; // sum
		let cartCount = 0; // items count
		const spanTotal = document.querySelector('.cart_total');
		const spanCount = document.querySelector('.cart_count');


		function addToCart(id) {
			let added;
			data.forEach(item=> {
				if(item.id === id){
					added = item;
				}
			});

			let wasInCart = false;
			let indexInCart;
			cart.forEach((item, index) => {
				if(item.id === id){
					wasInCart = true;
					indexInCart = index;
				}
			});

			if(!wasInCart){
				cart.push({...added, count: 1});
			}
			else {
				cart[indexInCart].count += 1;
			}


			cartTotal += added.price;
			cartCount += 1;
			spanCount.innerText = cartCount;
			spanTotal.innerText = cartTotal;
		}


	</script>

</body>
</html>