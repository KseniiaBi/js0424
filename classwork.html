<!DOCTYPE html>
<html lang="en">
<head>
	<title>JS FE</title> 
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<style>
		*{
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		.todoapp {
			display: flex;
			flex-direction: column;
			align-items: center;
		}

		.todoform{
			margin: 100px auto;
			width: 60%;
		}

		li{
			font-size: 24px;
			margin-bottom: 10px;
		}

		.hidden {
			display: none;
		}

		.done{
			text-decoration: line-through;
		}
		
		.del_btn, .edit_btn {
			display: inline-block;
			width: 24px;
			height: 24px;
			background-size: cover;
			cursor: pointer;
			margin-left: 20px;
		}

		.del_btn {
			background-image: url('delete.png');
		}

		.edit_btn {
			background-image: url('edit.png');
		}

	</style>
</head>
<body>

	<div class="todoapp">

		<h1>To Do List</h1>

		<form class="todoform">
			<input id="todoinput" type="text" placeholder="Type your task">
			<input type="submit" value="Save">
		</form>

		<h2>Any tasks yet. Add them with form above.</h2>

		<ol class="todolist"></ol>

	</div>
	
	<script>

		// To Do List

		const storage = window.localStorage;
		const APP_NAME = 'TodoList';
		const form = document.querySelector('.todoform');
		const input = document.querySelector('#todoinput');
		const txt = document.querySelector('h2');
		const list = document.querySelector('.todolist');
		let todos;
		const json = storage.getItem(APP_NAME);

		if( json === null || JSON.parse(json).length === 0){
			todos = [];
		}
		else {
			todos = JSON.parse(json);
			todos.forEach(item => createLi(item));
		}

		function saveToLS(){
			storage.setItem(APP_NAME, JSON.stringify(todos));
		}

		function checkTodos(){
			if(todos.length === 0){
				list.classList.add('hidden');
				txt.classList.remove('hidden');
			}
			else {
				list.classList.remove('hidden');
				txt.classList.add('hidden');
			}
		}
		checkTodos();

		function createLi(task){
			const todo = createEl('li', task.done ?['done']: []);
			todo.dataset.id = task.id;

			const todotext = createEl('span', [],task.task);
			const innerInput = createEl('input', ['hidden']);
			const del = createEl('span', ['del_btn']);
			const edit = createEl('span',['edit_btn']);

			todo.append(todotext, innerInput, del, edit);
			list.append(todo);
		}

		function createEl(tag, classes, text = ''){
			const el = document.createElement(tag);
			classes.length > 0 ? el.classList.add(...classes) : null;
			el.innerText = text;
			return el;
		}

		function saveTask(){
			const text = input.value;
			if(text.length > 2){
				const id = Date.now();
				const task = {
					task: text,
					id: id,
					done: false
				};
				todos.push(task);
				
				createLi(task);
				saveToLS();
				
				input.value = '';
				if(todos.length === 1){
					checkTodos();
				}
			}
		}

		function findTodo(id){
			let i;
			todos.forEach((item, index) => {
				if(item.id === id ){
					i = index;
				}
			});
			return i;	
		}

		function markAsDone(el){
			el.classList.toggle('done');
			const item = todos[findTodo(+el.dataset.id)];
			item.done = !item.done;
			saveToLS();
		}

		function deleteTask(el){
			const id = +el.dataset.id;
			el.remove();
			todos.splice([findTodo(id)], 1);
			saveToLS();
			if(todos.length === 0){
				checkTodos();
			}	
		}

		function editTask(el){
			const id = +el.dataset.id;
			
			const inp = el.querySelector('input');
			const textspan = el.querySelector('span');

			inp.value = textspan.textContent;
			inp.classList.remove('hidden');
			textspan.classList.add('hidden');

			inp.onkeyup = (e) => {
				if(e.key === 'Enter'){
					textspan.textContent = inp.value;
					inp.classList.add('hidden');
					textspan.classList.remove('hidden');
					const item = findTodo(id);
					item.task = inp.value;
					saveToLS();
				}
			}
		}

		form.onsubmit = (event) => {
			event.preventDefault();
			saveTask();
		}

		list.addEventListener('click', (e)=>{
			if(e.target.classList.contains('del_btn')){
				deleteTask(e.target.parentNode);
			}
			if(e.target.classList.contains('edit_btn')){
				editTask(e.target.parentNode);
			}
			if(e.target.tagName.toLowerCase() === 'li'){
				markAsDone(e.target);
			}
			if(e.target.parentNode.tagName.toLowerCase() === 'li'){
				markAsDone(e.target.parentNode);
			}
		});

		 // JSON.stringify(todos) -> todos to JSON
		 // JSON.parse(something) -> some JSON to js object/array

		 // localStorage methods: clear() [delete all data from LS], setItem(key, json) [adds to LS], 
		 // getItem(key) [get json by key], removeItem(key) [remove json by key]


	</script>

</body>
</html>